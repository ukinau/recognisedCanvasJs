/*! recognised-canvasjs 07-12-2016 */
function inherits(a,b){if(void 0===a||null===a)throw new TypeError("The constructor to `inherits` must not be null or undefined.");if(void 0===b||null===b)throw new TypeError("The super constructor to `inherits` must not be null or undefined.");if(void 0===b.prototype)throw new TypeError("The super constructor to `inherits` must have a prototype.");a.super_=b,Object.setPrototypeOf(a.prototype,b.prototype)}function arrowPos(a,b,c,d,e,f){var g=getUniVector(a,b);Ux=g[0],Uy=g[1],e[0]=b[0]-Uy*c-Ux*d,e[1]=b[1]+Ux*c-Uy*d,f[0]=b[0]+Uy*c-Ux*d,f[1]=b[1]-Ux*c-Uy*d}function getVector(a,b){var c=b[0]-a[0],d=b[1]-a[1];return[c,d]}function getUniVector(a,b){var c=getVector(a,b),d=c[0],e=c[1],f=Math.sqrt(d*d+e*e),g=d/f,h=e/f,i=[g,h];return i}function vectorDividedBy(a,b,c){var d=getVector(a,b),e=d[0]/c,f=d[1]/c;return[e,f]}function addVector(a,b){var c=[];return c[0]=a[0]+b[0],c[1]=a[1]+b[1],c}function extendVector(a,b,c,d){var e=getUniVector(a,b),f=[];return f[0]=b[0]+e[0]*c,f[1]=b[1]+e[1]*c,Vlimit=getVector(a,d),Vresult=getVector(a,f),comparedVector(Vlimit,Vresult,"<")?d:f}function subtractedVector(a,b,c,d){var e=getUniVector(a,b),f=[];return f[0]=b[0]-e[0]*c,f[1]=b[1]-e[1]*c,Vsub=[e[0]*c,e[1]*c],Vorg=getVector(a,b),comparedVector(Vsub,Vorg,">")?d:f}function comparedVector(a,b,c){var d=Math.sqrt(a[0]*a[0]+a[1]*a[1]),e=Math.sqrt(b[0]*b[0]+b[1]*b[1]);return">"==c?d>e:"<"==c?d<e:d==e}function randomNum(a,b){var c=b-a;return a+Math.random()*c}var BaseCanvasModel=function(){this.possitionX=0,this.possitionY=0,this.width=0,this.height=0,this.z_index=0,this.z_index_fixed=!1};BaseCanvasModel.prototype.get_possitionX_end=function(){return this.possitionX+this.width},BaseCanvasModel.prototype.get_possitionY_end=function(){return this.possitionY+this.height},BaseCanvasModel.prototype.collision_detect=function(a,b){return this.possitionX<a&&a<this.possitionX+this.width&&this.possitionY<b&&b<this.possitionY+this.height},ConnectionBaseCanvas=function(){this.begin_possition=[],this.end_possition=[],this.globalAlpha=null,this.strokeStyle=null,this.lineWidth=null,this.z_index=99},ConnectionBaseCanvas.prototype.calculate=function(){},ConnectionBaseCanvas.prototype.ctx_stash=function(a){return stash={},stash.globalAlpha=a.globalAlpha,stash.lineWidth=a.lineWidth,stash.strokeStyle=a.strokeStyle,stash.fillStyle=a.fillStyle,stash},ConnectionBaseCanvas.prototype.ctx_reset=function(a,b){a.globalAlpha=b.globalAlpha,a.lineWidth=b.lineWidth,a.strokeStyle=b.strokeStyle,a.fillStyle=b.fillStyle},ConnectionBaseCanvas.prototype.draw=function(a){stashed=this.ctx_stash(a),a.globalAlpha=this.globalAlpha,a.lineWidth=this.lineWidth,a.strokeStyle=this.strokeStyle,a.beginPath(),a.moveTo(this.begin_possition[0],this.begin_possition[1]),a.lineTo(this.end_possition[0],this.end_possition[1]),a.stroke(),this.ctx_reset(a,stashed)},ConnectionBaseCanvas.prototype.collision_detect=function(a,b){return!1},ArrowConnection=function(){ConnectionBaseCanvas.call(this),this.arrow_width=5,this.arrow_height=10},ArrowConnection.prototype.draw=function(a){this.end_possition[0]=Number(this.end_possition[0]),this.end_possition[1]=Number(this.end_possition[1]);var b=[],c=this.end_possition;this.end_possition=[],arrowPos(this.begin_possition,c,0,this.arrow_height,b,[]),this.end_possition[0]=Number(b[0]),this.end_possition[1]=Number(b[1]),ConnectionBaseCanvas.prototype.draw.call(this,a),this.end_possition=c,this.draw_arrow(a)},ArrowConnection.prototype.draw_arrow=function(a){var b=[],c=[];stashed=this.ctx_stash(a),a.globalAlpha=this.globalAlpha,a.lineWidth=this.lineWidth,a.strokeStyle=this.strokeStyle,a.fillStyle=this.strokeStyle,arrowPos(this.begin_possition,this.end_possition,this.arrow_width,this.arrow_height,b,c),a.moveTo(this.end_possition[0],this.end_possition[1]),a.lineTo(b[0],b[1]),a.lineTo(c[0],c[1]),a.fill(),this.ctx_reset(a,stashed)},inherits(ArrowConnection,ConnectionBaseCanvas);var ArrowConnectionWithTitle=function(a){ArrowConnection.call(this),this.title=new TextCanvasModel(a),this.title_seed_possition=randomNum(1.4,3)};ArrowConnectionWithTitle.prototype.draw=function(a){this.end_possition[0]=Number(this.end_possition[0]),this.end_possition[1]=Number(this.end_possition[1]),this.begin_possition[0]=Number(this.begin_possition[0]),this.begin_possition[1]=Number(this.begin_possition[1]);var b=this.end_possition,c=(this.begin_possition,vectorDividedBy(this.begin_possition,this.end_possition,this.title_seed_possition)),d=addVector(this.begin_possition,c),e=subtractedVector(this.begin_possition,d,13,this.begin_possition),f=extendVector(this.begin_possition,d,13,this.end_possition);this.end_possition=e,ConnectionBaseCanvas.prototype.draw.call(this,a),this.begin_possition=f,this.end_possition=b,ArrowConnection.prototype.draw.call(this,a),this.title.possitionY=d[1]+3;var g=this.title.get_px_width()/2;this.title.possitionX=d[0]-g,this.title.z_index=this.z_index,this.title.draw(a)},inherits(ArrowConnectionWithTitle,ArrowConnection);var SquareWithTitle=function(a,b){if(BaseCanvasModel.call(this),this.color="rgb(155, 187, 89)",this.globalAlpha=1,this.radius=15,this.lineWidth=3,this.lineColor="#000000",this.lineFlag=!1,this.title=new TextCanvasModel(a),this.title_vertical_align="center",b){for(var c=[["x","possitionX"],["y","possitionY"],["width","width"],["height","height"],["color","color"],["globalAlpha","globalAlpha"]],d=0;d<c.length;d++)b[c[d][0]]&&(this[c[d][1]]=b[c[d][0]]);for(var e=[["text-color","color"],["text-font","font"],["text-globalAlpha","globalAlpha"],["text-is_bold","is_bold"]],d=0;d<e.length;d++)b[e[d][0]]&&(this.title[e[d][1]]=b[e[d][0]])}};SquareWithTitle.prototype.calculate=function(){var a=this.width-this.title.get_px_width(),b=0;a>0&&(b=a/2),this.title.possitionX=this.possitionX+b;var c=null;"top"==this.title_vertical_align?c=this.title.get_px_height():"center"==this.title_vertical_align?(c=(this.height-this.title.get_px_height())/2,c<0&&(c=0),c+=this.title.get_px_height()):c=this.height-this.title.get_px_height()/4,this.title.possitionY=this.possitionY+c,this.title.z_index=this.z_index},SquareWithTitle.prototype.draw=function(a){var b=a.globalAlpha,c=a.lineWidth,d=a.fillStyle,e=a.strokeStyle;a.globalAlpha=this.globalAlpha,a.lineWidth=this.lineWidth,a.strokeStyle=this.lineColor,a.fillStyle=this.color,a.beginPath(),a.moveTo(this.possitionX+this.radius,this.possitionY),a.lineTo(this.possitionX+this.width-this.radius,this.possitionY),a.quadraticCurveTo(this.possitionX+this.width,this.possitionY,this.possitionX+this.width,this.possitionY+this.radius),a.lineTo(this.possitionX+this.width,this.possitionY+this.height-this.radius),a.quadraticCurveTo(this.possitionX+this.width,this.possitionY+this.height,this.possitionX+this.width-this.radius,this.possitionY+this.height),a.lineTo(this.possitionX+this.radius,this.possitionY+this.height),a.quadraticCurveTo(this.possitionX,this.possitionY+this.height,this.possitionX,this.possitionY+this.height-this.radius),a.lineTo(this.possitionX,this.possitionY+this.radius),a.quadraticCurveTo(this.possitionX,this.possitionY,this.possitionX+this.radius,this.possitionY),a.fill(),this.lineFlag&&a.stroke(),a.globalAlpha=1,this.calculate(),this.title.draw(a),a.globalAlpha=b,a.lineWidth=c,a.fillStyle=d,a.strokeStyle=e},SquareWithTitle.prototype.get_aspects=function(){return results={right:{begin:{x:this.get_possitionX_end(),y:this.possitionY},end:{x:this.get_possitionX_end(),y:this.get_possitionY_end()}},left:{begin:{x:this.possitionX,y:this.possitionY},end:{x:this.possitionX,y:this.get_possitionY_end()}},top:{begin:{x:this.possitionX,y:this.possitionY},end:{x:this.get_possitionX_end(),y:this.possitionY}},down:{begin:{x:this.possitionX,y:this.get_possitionY_end()},end:{x:this.get_possitionX_end(),y:this.get_possitionY_end()}}},results},inherits(SquareWithTitle,BaseCanvasModel);var TextboxSquare=function(a,b){SquareWithTitle.call(this,b),this.lines=0,this.text_turned=[],this.ctx=a,this.text=this.title,this.text_margin_left=5,this.text_margin_top=3,this.text_init_margin_top=20};TextboxSquare.prototype.draw=function(a){var b=a.globalAlpha,c=a.lineWidth,d=a.fillStyle;a.globalAlpha=this.globalAlpha,a.lineWidth=this.lineWidth,a.fillStyle=this.color,a.fillRect(this.possitionX,this.possitionY,this.width,this.height),a.strokeRect(this.possitionX,this.possitionY,this.width,this.height),a.globalAlpha=1,this.calculate();for(var e=0;e<this.text_turned.length;e++)this.text_turned[e].draw(a);a.globalAlpha=b,a.lineWidth=c,a.fillStyle=d},TextboxSquare.prototype.calculate=function(){this.text.possitionX=this.possitionX+this.text_margin_left,this.text.possitionY=this.possitionY+this.text_init_margin_top,this.text.z_index=this.z_index,this.calculate_turned_text();for(var a=0;a<this.text_turned.length;a++)this.text_turned[a].possitionY+=this.text_turned[a].get_px_height()*a},TextboxSquare.prototype.calculate_turned_text=function(){this.lines=0,this.text_turned=[this.create_copy_of(this.text,"")];var a=this.ctx.font;this.ctx.font=this.text.font;for(var b=0;b<this.text.content.length;b++){var c=this.text.content.charAt(b);"\n"==c&&(this.lines++,this.text_turned[this.lines]=this.create_copy_of(this.text,"")),this.ctx.measureText(this.text_turned[this.lines].content+c).width>this.width-2*this.text_margin_left&&(this.lines++,this.text_turned[this.lines]=this.create_copy_of(this.text,"")),this.text_turned[this.lines].content+=c}this.ctx.font=a},TextboxSquare.prototype.create_copy_of=function(a,b){var c=new TextCanvasModel(b);return c.color=a.color,c.font=a.font,c.globalAlpha=a.globalAlpha,c.lineWidth=a.lineWidth,c.possitionX=a.possitionX,c.possitionY=a.possitionY,c.z_index=a.z_index,c.is_bold=a.is_bold,c},inherits(TextboxSquare,SquareWithTitle);var TextCanvasModel=function(a){BaseCanvasModel.call(this),this.color="rgb(0, 0, 0)",this.font="20px sans-serif",this.content=a,this.globalAlpha=1,this.is_bold=!0,this.lineWidth=2};TextCanvasModel.prototype.draw=function(a){var b=a.globalAlpha,c=a.fillStyle,d=a.font,e=a.lineWidth,f=a.strokeStyle;a.globalAlpha=this.globalAlpha,a.fillStyle=this.color,a.font=this.font,a.lineWidth=this.lineWidth,a.strokeStyle=this.color,this.is_bold&&a.strokeText(this.content,this.possitionX,this.possitionY),a.fillText(this.content,this.possitionX,this.possitionY),a.font=d,a.globalAlpha=b,a.fillStyle=c,a.lineWidth=e,a.strokeStyle=f},TextCanvasModel.prototype.get_px_width=function(){return Number(this.font.match(/([0-9].)px/)[1])/1.7*this.content.length},TextCanvasModel.prototype.get_px_height=function(){return Number(this.font.match(/([0-9].)px/)[1])},inherits(TextCanvasModel,BaseCanvasModel);var DrawConnectionObject=function(a,b,c){this.from=a,this.to=b,this.options="object"==typeof c?c:{},this.options.title?this.canvas=new ArrowConnectionWithTitle(this.options.title):this.canvas=new ArrowConnection,this.unHighlight()};DrawConnectionObject.prototype.calculate=function(){this.canvas.begin_possition=this.from.get_connecting_point(this.to),this.canvas.end_possition=this.to.get_connecting_point(this.from),this.canvas.calculate()},DrawConnectionObject.prototype.highlight=function(a){this.canvas.strokeStyle="black",this.canvas.globalAlpha=1,this.canvas.lineWidth=3,a.color&&(this.canvas.strokeStyle=a.color),a.globalAlpha&&(this.canvas.globalAlpha=a.globalAlpha),a.lineWidth&&(this.canvas.lineWidth=a.lineWidth)},DrawConnectionObject.prototype.unHighlight=function(){this.canvas.strokeStyle="black",this.canvas.globalAlpha=.1,this.canvas.lineWidth=2};var DrawObject=function(a,b,c){this.super_draw_object=null,this.super_draw_margin=28,this.children_draw_objects=[],this.id=a,this.options="object"==typeof c?c:{},this.canvas=b,this.connecting_points={top:{},down:{},left:{},right:{}},this.connecting_points_space=10,this.connections=[],this.event_functions={mousedown:null,"mousedown:clear":null,mousemove:null,"mousemove:clear":null}};DrawObject.prototype.configure_super=function(a){a.children_draw_objects.push(this),this.super_draw_object=a},DrawObject.prototype.calculate=function(){if(this.is_super()){for(var a=0;a<this.children_draw_objects.length;a++)this.children_draw_objects[a].calculate();this.canvas.possitionX=this.get_mostleft()-this.super_draw_margin,this.canvas.possitionY=this.get_mosttop()-this.super_draw_margin,this.canvas.width=this.get_mostright()-this.get_mostleft()+2*this.super_draw_margin,this.canvas.height=this.get_mostdown()-this.get_mosttop()+2*this.super_draw_margin,this.canvas.title_vertical_align="top",this.canvas.lineFlag=!0}this.canvas.z_index_fixed||(this.canvas.z_index=this.get_generation()),this.canvas.calculate(),this.init_connecting_points();for(var a=0;a<this.connections.length;a++)this.connections[a].calculate()},DrawObject.prototype.init_connecting_points=function(){var a=this.canvas.get_aspects();for(var b in a){var c=[];if("right"===b||"left"===b)for(var d=a[b].begin.y,e=a[b].end.y,f=d;f<e;f+=this.connecting_points_space){var g=[a[b].begin.x];g.push(f),c.push(g)}else for(var h=a[b].begin.x,i=a[b].end.x,f=h;f<i;f+=this.connecting_points_space){var g=[a[b].begin.y];g.unshift(f),c.push(g)}this.connecting_points[b]={};for(var j=0;j<c.length;j++)this.connecting_points[b][c[j]]=[]}},DrawObject.prototype.is_super=function(){return this.children_draw_objects.length>0},DrawObject.prototype.get_mostleft=function(){for(var a=null,b=0;b<this.children_draw_objects.length;b++){var c=this.children_draw_objects[b];null==a&&(a=c.canvas.possitionX),c.canvas.possitionX<a&&(a=c.canvas.possitionX)}return a},DrawObject.prototype.get_mostright=function(){for(var a=null,b=0;b<this.children_draw_objects.length;b++){var c=this.children_draw_objects[b];null==a&&(a=c.canvas.get_possitionX_end()),c.canvas.get_possitionX_end()>a&&(a=c.canvas.get_possitionX_end())}return a},DrawObject.prototype.get_mosttop=function(){for(var a=null,b=0;b<this.children_draw_objects.length;b++){var c=this.children_draw_objects[b];null==a&&(a=c.canvas.possitionY),c.canvas.possitionY<a&&(a=c.canvas.possitionY)}return a},DrawObject.prototype.get_mostdown=function(){for(var a=null,b=0;b<this.children_draw_objects.length;b++){var c=this.children_draw_objects[b];null==a&&(a=c.canvas.get_possitionY_end()),c.canvas.get_possitionY_end()>a&&(a=c.canvas.get_possitionY_end())}return a},DrawObject.prototype.get_generation=function(){if(null==this.super_draw_object)return 0;var a=this.super_draw_object.get_generation();return a+1},DrawObject.prototype.get_connecting_point=function(a){var b=this.which_aspect_is_closer(a),c=this.connecting_points[b],d=null,e=[];for(var f in c)f=f.split(","),null==d&&(d=f,e=c[f]),e.length>c[f].length&&(d=f,e=c[f]);return e.push(a),d},DrawObject.prototype.which_aspect_is_closer=function(a){var b="left",c="right",d="top",e="down",f=this.canvas.get_possitionX_end(),g=this.canvas.get_possitionY_end(),h=null,i=null,j=null,k=null;return a.canvas.possitionX>this.canvas.possitionX?(j=c,i=a.canvas.possitionX-f):(j=b,i=this.canvas.possitionX-a.canvas.possitionX),a.canvas.possitionY>this.canvas.possitionY?(k=e,h=a.canvas.possitionY-g):(k=d,h=this.canvas.possitionY-a.canvas.possitionY),h>i?k:j},DrawObject.prototype.add_connection=function(a){this.connections.push(a)},DrawObject.prototype.add_connection_to=function(a,b){return drawConObj=new DrawConnectionObject(this,a,b),this.add_connection(drawConObj),a.add_connection(drawConObj),drawConObj},DrawObject.prototype.event_handler=function(a,b){this.event_functions[a]&&this.event_functions[a](this,a,b)},DrawObject.prototype.event_function_register=function(a,b){this.event_functions[a]=b};var Pallet=function(a,b){this.canvas_dom=b,this.ctx=a,this.draw_objects=[],this.draw_objects_z_map={},this.event_object={mousedown:null,mousemove:null,dragging:null}};Pallet.prototype.add_object=function(a){this.draw_objects.push(a)},Pallet.prototype.remove_object=function(a){for(var b=0;b<this.draw_objects.length;b++)this.draw_objects[b]===a&&this.draw_objects.splice(b,1)},Pallet.prototype.find_object=function(a,b){for(var c=0;c<this.draw_objects.length;c++)if(this.draw_objects[c].options[a]==b)return this.draw_objects[c]},Pallet.prototype._sort_object_by_z=function(){this.draw_objects_z_map={};for(var a=0;a<this.draw_objects.length;a++){this.draw_objects[a].calculate();var b=this.draw_objects[a].canvas.z_index;"[object Array]"==Object.prototype.toString.call(this.draw_objects_z_map[b])?this.draw_objects_z_map[b].push(this.draw_objects[a]):(this.draw_objects_z_map[b]=[],this.draw_objects_z_map[b].push(this.draw_objects[a]))}},Pallet.prototype._get_sorted_zindex_list=function(){var a=Object.keys(this.draw_objects_z_map);return a.sort(function(a,b){return Number(a)<Number(b)?-1:Number(a)>Number(b)?1:0}),a},Pallet.prototype.render=function(){this.ctx.clearRect(0,0,this.canvas_dom.width,this.canvas_dom.height),this._sort_object_by_z();for(var a=this._get_sorted_zindex_list(),b=0;b<a.length;b++)for(var c=a[b],d=0;d<this.draw_objects_z_map[c].length;d++)this.draw_objects_z_map[c][d].canvas.draw(this.ctx)},Pallet.prototype.setMouseEventToDocument=function(a){for(var b=["mousedown","mousemove"],c=0;c<b.length;c++){var d=this.genMouseEventHandler(b[c]);a.addEventListener(b[c],d)}a.addEventListener("mouseup",this.getMouseUpEventHandler())},Pallet.prototype.getMouseUpEventHandler=function(){var a=this,b=function(b){a.event_object.dragging&&(a.event_object.dragging.event_handler("dragging:clear"),a.event_object.dragging=null)};return b},Pallet.prototype.genMouseEventHandler=function(a){var b=this,c=function(c){var d=c.target.getBoundingClientRect(),e=c.clientX-d.left,f=c.clientY-d.top,g={x:e,y:f},h={};if("mousemove"==a&&b.event_object.dragging)b.event_object.dragging.event_handler("dragging",g);else{for(var i=0;i<b.draw_objects.length;i++){var j=b.draw_objects[i];j.canvas.collision_detect(e,f)&&(h[j.canvas.z_index]?h[j.canvas.z_index].push(j):h[j.canvas.z_index]=[j])}var k=Object.keys(h);if(k.length>0){k.sort(function(a,b){return Number(a)<Number(b)?1:Number(a)>Number(b)?-1:0});var l=k.shift(),m=h[l],n=m[0];b.event_object[a]!=n?(b.event_object[a]&&b.event_object[a].event_handler(a+":clear"),b.event_object[a]=n,n.event_handler(a,g)):n.event_handler(a,g),"mousedown"==a&&(b.event_object.dragging=n)}else b.event_object[a]&&(b.event_object[a].event_handler(a+":clear"),b.event_object[a]=null)}};return c};